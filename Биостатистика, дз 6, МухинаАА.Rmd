---
title: "Биостатистика, дз 6"
author: "Мухина А.А."
date: "2024-04-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Домашнее задание 6

*Тема:* расчет выборки при планировании исследования.

*Цель:* научиться рассчитывать выборку для исследований с различными конечными точками.


При выполнении этого домашнего задания вам необходимо посчитать выборки для различных типов точек. Напишите соответствующий код, пользуясь указанными формулами.

Пусть наш спонсор заинтересован, чтобы исследование имело 80% мощность, а уровень значимости — 5%, ожидаемый drop-out rate = 10%.

```{r}
# Мощность
beta <- 0.8
# Уровень значимости
alpha <- 0.05
# drop-out rate
drop_out_rate <- 0.1
```


***

## Задание 1

Рассчитайте выборку для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна. Из предыдущих исследований известно, что дисперсия составляет 20%, а разница средних составляет −10%. Клиницисты сообщают нам, что клинически значимая разница составляет 25%.

***

Зададим по условию дисперсию, разницу средних и клинически значимую разницу

```{r}
sigma <- 0.2
epsilon <- -0.1
delta <- 0.25
```


Для расчетов в задании рекомендовано воспользоваться следующей формулой:

$$
n_1 = n_2 = \frac{(Z_{\alpha/2} + Z_{\beta})^2\sigma_m^2}{2*(\delta-|\varepsilon|)^2}, n = n_1 + n_2
$$

Итак

```{r}
n_1 = (((qnorm(1 - alpha/2) + qnorm(beta)) ^ 2)  * sigma ^ 2) / (2 * ((delta - abs(epsilon)) ^ 2))

n <- 2 * n_1

n <- ceiling(n / (1 - drop_out_rate))

n
```

Итого, размер выборки с учетом drop-out rate составит 16 человек


***

## Задание 2

Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного параллельного дизайна. Пусть клинически значимая разница -0.1, то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата 0.65, в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет 0.85. Соотношение групп равно 1.

***

Из условий:

```{r}
delta <- -0.1
p_1 <- 0.85
p_2 <- 0.65
k <- 1
```

Для расчетов в задании рекомендовано воспользоваться следующей формулой:

$$
n_1 = n_2 = \frac{(Z_{\alpha/2} + Z_{\beta})^2(p_1*(1-p_1) + p_2*(1-p_2))}{(p_1 - p_2 - \delta)^2}, n = n_1 + n_2
$$

Подставим значения в формулу

```{r}
n_1 = (((qnorm(1 - alpha/2) + qnorm(beta)) ^ 2)  * (p_1 * (1 - p_1) + p_2 * (1 - p_2))) / 
      ((p_1 - p_2 - delta) ^ 2)

n <- 2 * n_1

n <- ceiling(n / (1 - drop_out_rate))

n
```
Итого, размер выборки с учетом drop-out rate составит 69 человек


***

## Задание 3

Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов (d = 0.8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны.

***

Из условия:

```{r}
hr <- 2
d <- 0.8
p1 <- 0.5
p2 <- 0.5
```

Для расчетов в задании рекомендовано воспользоваться следующей формулой:

$$
n_1 = n_2 = \frac{(Z_{\alpha/2} + Z_{\beta})^2}{ln(HR)^2p_1p_2d}, n = n_1 + n_2
$$

Подставим значения в формулу

```{r}
n_1 = ((qnorm(1 - alpha/2) + qnorm(beta)) ^ 2) / (log(hr ^ 2) * p1 * p2 * d)

n <- 2 * n_1

n <- ceiling(n / (1 - drop_out_rate))

n
```
Итого, размер выборки с учетом drop-out rate составит 63 человека









